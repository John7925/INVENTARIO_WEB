<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consulta de Bienes</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="script-resguardante.js"></script>

  <!--  Bloque de validaci贸n institucional -->
  <script>
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxu6fuNY-Vc4fIYiPNTGhobaAsbkgBOD9koCgOvbZPUNy6skr2YTuZ_FE3WGVDbXlFm/exec";

    async function validarAccesoPagina() {
      let correo = localStorage.getItem('correo');
      if (!correo || correo.trim() === "") {
        alert("Acceso restringido. Ingresa desde el men煤 principal.");
        window.location.href = "index.html";
        return;
      }

      try {
        const res = await fetch(`${URL_SCRIPT}?accion=validar&correo=${encodeURIComponent(correo)}`);
        const respuesta = await res.text();

        if (respuesta !== "autorizado") {
          alert("Acceso denegado. Solicita autorizaci贸n desde el men煤 principal.");
          localStorage.removeItem('correo');
          window.location.href = "index.html";
        }
      } catch (error) {
        console.error("Error en validaci贸n:", error);
        alert("Error de validaci贸n. Regresa al men煤 principal.");
        window.location.href = "index.html";
      }
    }

    window.onload = validarAccesoPagina;
  </script>
</head>
<body>
  <!--  Encabezado horizontal -->
  <div class="fila-encabezado-secundario">
    <h1 class="encabezado">CONSULTA POR RESGUARDANTE</h1>
    <div id="contenedorBotonExcel" style="display: none;">
      <button id="botonDescargarExcel">Descargar Excel</button>
    </div>
  </div>

  <!-- B煤squeda -->
  <div class="fila-busqueda">
    <input type="text" id="idEmpInput" placeholder="NMERO DE EMPLEADO" />
    <button onclick="buscarEmpleado()">Buscar</button>
    <button onclick="limpiarCampos()">Limpiar</button>
    <button class="boton-inicio" onclick="location.href='index.html'">INICIO</button>
  </div>

  <!-- Encabezado institucional -->
  <div class="fila-institucional">
    <div class="logo-container">
      <img src="logo-cdmx.png" alt="Logo Institucional" class="logo" />
    </div>
    <div class="texto-institucional">
      <p>
        <strong>SECRETARA DE SALUD DE LA CIUDAD DE MXICO</strong><br>
        DIRECCIN GENERAL DE ADMINISTRACIN Y FINANZAS<br>
        DIRECCIN DE RECURSOS MATERIALES, ABASTECIMIENTOS Y SERVICIOS<br>
        SUBDIRECCIN DE BIENES MUEBLES E INVENTARIOS<br>
        JEFATURA DE LA UNIDAD DEPARTAMENTAL DE CONTROL DE BIENES
      </p>
    </div>
  </div>

  <div class="fila-encabezado">
    <div class="encabezado-izquierda">RESGUARDO DE BIENES INVENTARIABLES</div>
    <div class="encabezado-derecha">EJERCICIO FISCAL 2025</div>
  </div>

  <!--  Recuadro de confirmaci贸n -->
  <div id="recuadroConfirmacion" class="recuadro-confirmacion" style="display:none;">
    <p><strong>驴Deseas consultar los bienes del empleado?</strong></p>
    <p>ID EMP: <span id="idConfirmado"></span></p>
    <p>Nombre: <span id="nombreConfirmado"></span></p>
    <p>Total de bienes: <span id="totalBienes"></span></p>
    <button id="botonAceptarConfirmacion"
      style="background-color:#006341;color:white;border:none;padding:10px 20px;font-weight:bold;border-radius:4px;cursor:pointer;margin-top:10px;">
      Aceptar
    </button>
  </div>

  <!-- Datos del resguardante -->
  <div class="fila-grid">
    <div class="col-2 col-span-1 etiqueta-gris">NOMBRE DEL<br>RESGUARDANTE:</div>
    <div class="col-3 col-span-2 campo-dato" id="nombreResguardante"></div>

    <div class="col-6 col-span-1 etiqueta-gris">NMERO DE<br>EMPLEADO:</div>
    <div class="col-7 col-span-2 campo-dato" id="numeroEmpleado"></div>

    <div class="col-9 col-span-1 etiqueta-gris">RFC CON<br>HOMOCLAVE:</div>
    <div class="col-10 col-span-1 campo-dato" id="rfcEmpleado"></div>
  </div>

  <div class="fila-grid">
    <div class="col-2 col-span-1 etiqueta-gris">PUESTO:</div>
    <div class="col-3 col-span-2 campo-dato" id="puestoEmpleado"></div>

    <div class="col-6 col-span-1 etiqueta-gris">RGIMEN DE CONTRATACIN:</div>
    <div class="col-7 col-span-3 campo-dato" id="regimenContratacion"></div>
  </div>

  <div class="fila-grid">
    <div class="col-2 col-span-1 etiqueta-gris">REA:</div>
    <div class="col-3 col-span-5 campo-dato" id="areaAdscripcion"></div>
  </div>

  <div class="fila-grid">
    <div class="col-2 col-span-1 etiqueta-gris">UNIDAD DE ADSCRIPCIN:</div>
    <div class="col-3 col-span-5 campo-dato" id="unidadAdscripcion"></div>
  </div>

  <div class="fila-legal">
    <div class="texto-legal-sin-recuadro">
      LOS BIENES DE ESTA RELACIN SON DE MI RESPONSABILIDAD, POR LO QUE CUALQUIER TIPO DE MOVIMIENTO (CAMBIO DE USUARIO, ROBO, DESTRUCCIN ACCIDENTADA, BAJA, ETC.) SE INFORMAR POR OFICIO A LA JEFATURA DE UNIDAD DEPARTAMENTAL DE CONTROL DE BIENES
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <div id="tablaBienes"></div>
</body>
</html>
